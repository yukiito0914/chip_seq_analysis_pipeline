# ChIP-seq Analysis Pipeline
This Nextflow pipeline processes ChIP-seq data from raw FASTQ files through quality control, trimming, alignment, peak calling, reproducibility filtering, coverage analysis, annotation, and motif discovery. The pipeline is modular and reproducible, supporting both Singularity and Conda.

## Pipeline Overview
FASTQ → Quality Control → Trimming → Alignment → BAM Processing → Coverage Analysis → Peak Calling → Reproducibility Filtering → Annotation → Motif Discovery → Signal Profiling

## Pipeline Modules
| Step                     | Tool(s)           | Description                                                             |
|--------------------------|-------------------|-------------------------------------------------------------------------|
| Quality Control          | `FASTQC`, `MULTIQC` | Assess raw and trimmed read quality                                    |
| Trimming                 | `TRIMMOMATIC`      | Remove adapters and low-quality bases                                  |
| Genome Indexing          | `BOWTIE2_BUILD`     | Build genome index for alignment                                       |
| Alignment                | `BOWTIE2_ALIGN`     | Map reads to the reference genome                                      |
| BAM Processing           | `SAMTOOLS_SORT`, `SAMTOOLS_IDX`, `SAMTOOLS_FLAGSTAT` | Sort, index, and generate alignment stats for BAM files |
| Coverage Analysis        | `DEEPTOOLS_BAMCOVERAGE`, `MULTIBIGWIGSUMMARY`, `PLOTCORRELATION` | Generate bigWig files and assess sample correlation     |
| Peak Calling             | `CALLPEAK`         | Call peaks using MACS2                                                 |
| Reproducibility Filtering| `INTERSECT`        | Intersect peaks across replicates                                      |
| Blacklist Filtering      | `REMOVE`           | Remove blacklisted genomic regions                                     |
| Annotation               | `HOMER`            | Annotate peaks with gene features                                      |
| Motif Discovery          | `FINDMOTIF`        | Identify enriched sequence motifs near peaks                           |
| Signal Profiling         | `COMPUTEMATRIX`, `PLOTPROFILE` | Plot ChIP enrichment across genomic features              |

## Input Requirement
| Parameter           | Description                                                                 |
|---------------------|-----------------------------------------------------------------------------|
| `params.samplesheet`     | CSV file with sample names and paths to FASTQ files                         |
| `params.adapter_fa`      | Adapter sequence file for trimming (e.g. Illumina TruSeq)                   |
| `params.genome`          | Reference genome in FASTA format (e.g. GRCh38)                              |
| `params.gtf`             | Gene annotation file in GTF format (e.g. GENCODE)                           |
| `params.blacklist`       | BED file of blacklisted genomic regions to be removed from peak calls       |
| `params.bed`             | BED file of regions for signal profiling (e.g. promoters, TSS)              |

## Running the Pipeline
To execute the pipeline with default parameters:
```bash
nextflow run main.nf
```

## Output Files
The pipeline produces the following outputs under ```results/```:

| Directory                 | Contents                                                                 |
|---------------------------|--------------------------------------------------------------------------|
| `fastqc/`                 | Quality control reports (raw and trimmed reads) from FASTQC             |
| `multiqc/`                | Aggregated QC summary report from MultiQC                               |
| `bam/`                    | Sorted and indexed BAM files after alignment and post-processing        |
| `coverage/`               | bigWig coverage tracks generated by deepTools `bamCoverage`             |
| `peaks/`                  | MACS2 narrowPeak files for each replicate                               |
| `reproducible_peaks/`     | Peaks common across replicates (BED files after intersection)           |
| `filtered_peaks/`         | Reproducible peaks after filtering blacklisted regions                  |
| `annotations/`            | Annotated peaks using HOMER (gene names, distances, features)           |
| `motifs/`                 | Motif discovery results from HOMER                                      |
| `plots/correlation/`      | Signal correlation heatmaps from `plotCorrelation`                      |
| `plots/profile/`          | Enrichment profiles around regions (e.g., TSS) from `plotProfile`       |
| `matrices/`               | Signal matrices from `computeMatrix` used for plotting profiles         |

## Example Output Figures
### Signal Correlation Heatmap
![image](https://github.com/user-attachments/assets/8ee8ef1c-9885-4152-ad1c-b0dff7a88a9b)

### ChIP Enrichment Around TSS (Profile Plot)
![image](https://github.com/user-attachments/assets/c4153d7e-8636-42a1-9a0f-9d687ccf4054)

## Example ```samplesheet.csv```
```csv
name,path
INPUT_rep1,/projectnb/bf528/materials/project-2-chipseq/full_files/INPUT_rep1.fastq.gz
INPUT_rep2,/projectnb/bf528/materials/project-2-chipseq/full_files/INPUT_rep2.fastq.gz
IP_rep1,/projectnb/bf528/materials/project-2-chipseq/full_files/IP_rep1.fastq.gz
IP_rep2,/projectnb/bf528/materials/project-2-chipseq/full_files/IP_rep2.fastq.gz
```
